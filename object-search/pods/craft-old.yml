!CompoundExecutor
components:
  - !ImageReader
    with:
      from_bytes: True
    metas:
      name: img_read
  - !ImageNormalizer
    with:
      target_size: 96
      img_mean: [0.485, 0.456, 0.406]
      img_std: [0.229, 0.224, 0.225]
      channel_axis: -1
    metas:
      name: img_norm
  - !TorchObjectDetectionSegmenter
    with:
      target_size: (96, 96)
      channel_axis: -1
      confidence_threshold: 0.1
    metas:
      name: img_detect
  # - !ImageResizer
  #   with:
  #     target_size: 96
  #   metas:
  #     name: img_resize
metas:
  name: compound_crafter
requests:
  on:
    IndexRequest:
      - !CraftDriver
        with:
          executor: img_read
      - !CraftDriver
        with:
          executor: img_norm
      - !SegmentDriver
        with:
          executor: img_detect
      # - !CraftDriver 
      #   with:
      #     executor: img_resize
    SearchRequest:
      - !URI2Buffer {}
      - !CraftDriver
        with:
          executor: img_read
      - !CraftDriver
        with:
          executor: img_norm
      # - !CraftDriver
      #   with:
      #     executor: img_detect
    ControlRequest:
      - !ControlReqDriver {}